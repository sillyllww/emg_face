<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>é¢ç˜«åº·å¤ Web ç³»ç»Ÿ - æ•°æ®é‡‡é›†</title>

  <!-- å‰ç«¯ä¸å†éœ€è¦æ•°æ®å¤„ç†åº“ï¼Œæ‰€æœ‰EMGæ•°æ®å¤„ç†ç”±PythonæœåŠ¡å™¨å®Œæˆ -->

  <style>
    /* ========== å…¨å±€é‡ç½® ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      font-family: "PingFang SC", "Noto Sans", sans-serif;
      background-color: #F0F2F5;
      color: #333333;
      overflow: hidden;
    }
    a {
      text-decoration: none;
      color: inherit;
    }
    ul {
      list-style: none;
    }

    /* ========== å®¹å™¨å¸ƒå±€ ========== */
    .container {
      display: grid;
      grid-template-columns: 240px 1fr;
      grid-template-rows: 1fr;
      height: 100vh;
      width: 100vw;
    }

    /* ========== å·¦ä¾§å¯¼èˆªæ  (Sidebar) ========== */
    .sidebar {
      grid-column: 1 / 2;
      background-color: #FFFFFF;
      padding: 16px 12px;
      box-shadow: 2px 0 6px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
    }
    .sidebar .logo {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 24px;
      text-align: center;
      color: #007BFF;
    }
    .sidebar nav {
      flex: 1;
    }
    .sidebar nav ul > li {
      margin-bottom: 12px;
    }
    .sidebar nav ul > li > a {
      display: block;
      padding: 12px 16px;
      font-size: 14px;
      color: #555555;
      border-radius: 8px;
      transition: all 0.3s;
    }
    .sidebar nav ul > li > a:hover {
      background-color: rgba(0, 123, 255, 0.08);
      color: #007BFF;
    }
    .sidebar nav ul > li > a.active {
      background-color: #007BFF;
      color: white;
    }
    .sidebar .divider {
      margin: 16px 0;
    }
    .sidebar .submenu {
      margin-left: 8px;
    }
    .sidebar .submenu li {
      margin-bottom: 8px;
    }
    .sidebar .submenu li a {
      font-size: 14px;
      font-weight: 400;
      padding: 8px 16px;
      border-radius: 8px;
      color: #555555;
    }
    .sidebar .submenu li a:hover {
      background-color: rgba(0, 123, 255, 0.08);
    }

    /* ========== ä¸­é—´ä¸»å†…å®¹åŒº ========== */
    .main-content {
      grid-column: 2 / 3;
      display: flex;
      flex-direction: column;
      padding: 16px 20px;
      padding-right: 340px;
      gap: 16px;
      height: 100vh;
      overflow: hidden;
    }

    /* ---- ä¸­é—´å†…å®¹åŒºåŸŸ ---- */
    .center-content {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* ä¸»é¢æ¿æ ·å¼è°ƒæ•´ */
    .main-panel {
      background-color: #F0F2F5;
      border-radius: 16px;
      padding: 24px;
      display: flex;
      gap: 24px;
      align-items: stretch;
      height: 55vh;
      margin-bottom: 16px;
    }

    /* è‚Œç”µé‡‡é›†åŒºåŸŸ - å·¦ä¾§ */
    .panel-emg {
      flex: 1;
      height: 100%;
      background-color: #FFFFFF;
      border-radius: 12px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }

    .panel-emg .title {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: 16px;
      color: #333333;
    }

    .panel-emg .content, #face-capture-container {
      flex: 1;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      background-color: #f8f9fa;
      position: relative;
      overflow: hidden;
      border: 2px solid #e9ecef;
      transition: border-color 0.2s ease;
    }
    
    .panel-emg .content:hover, #face-capture-container:hover {
      border-color: #007BFF;
    }

    .panel-emg .content canvas {
      max-width: 100% !important;
      max-height: 100% !important;
      width: auto !important;
      height: auto !important;
      border-radius: 12px;
      object-fit: contain;
    }

    .panel-emg .content::after {
      content: '';
      position: absolute;
      color: #AAAAAA;
      font-size: 14px;
      display: none;
    }
    
    /* 3Dæ¨¡å‹åŠ è½½çŠ¶æ€ */
    .model-loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #666;
      font-size: 14px;
      text-align: center;
    }
    
    /* é¢éƒ¨è¡¨æƒ…é¢„è§ˆåŒºåŸŸå ä½ç¬¦ */
    .face-capture-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #666;
      font-size: 14px;
      text-align: center;
      gap: 12px;
      width: 100%;
      height: 100%;
    }
    
    .face-capture-placeholder .icon {
      font-size: 48px;
      color: #ddd;
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 0.6;
        transform: scale(1);
      }
      50% {
        opacity: 1;
        transform: scale(1.05);
      }
    }
    
    /* å½“æœ‰å†…å®¹æ—¶éšè—å ä½ç¬¦ */
    #face-capture-container:not(:empty) .face-capture-placeholder {
      display: none;
    }
    
    /* é”™è¯¯çŠ¶æ€æ ·å¼ */
    .face-capture-error {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #dc3545;
      font-size: 14px;
      text-align: center;
      gap: 12px;
      width: 100%;
      height: 100%;
    }
    
    .face-capture-error .icon {
      font-size: 48px;
      color: #dc3545;
    }

    /* è§†é¢‘é¢„è§ˆåŒºåŸŸ - å³ä¾§ */
    .preview-container {
      flex: 1;
      height: 100%;
      background-color: #000; /* èƒŒæ™¯é»‘è‰² */
      border-radius: 12px;
      position: relative;
    }

    .panel-preview {
      position: relative;
      height: 100%;
      background-color: #000; /* èƒŒæ™¯ä¸ºé»‘è‰² */
      border-radius: 12px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      padding: 20px;
    }

    .panel-preview .task-title {
      font-size: 16px;
      font-weight: 500;
      color: #FFF;
      margin-bottom: 16px;
      text-align: center;
    }

    .panel-preview .video-box {
      background-color: #000;
      border-radius: 12px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      flex: 1;
      margin-bottom: 16px;
    }

    .panel-preview .video-box video,
    .panel-preview .video-box img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      background-color: #000;
    }

    /* å±…ä¸­çš„ç°è‰²æç¤ºæ¡† */
    .panel-preview .center-overlay {
      position: absolute;
      width: 60%;
      height: 20%;
      background-color: rgba(128, 128, 128, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      color: #FFF;
      font-size: 20px;
      text-align: center;
      top: 40%;
      left: 20%;
      visibility: hidden;
      z-index: 3;
      display: none; /* éšè—æç¤ºæ¡† */
    }

    /* åº•éƒ¨ç°è‰²æç¤ºæ¡† */
    .panel-preview .bottom-overlay {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 70%;
      background-color: rgba(128, 128, 128, 0.9);
      color: #FFF;
      font-size: 18px;
      text-align: center;
      padding: 8px;
      border-radius: 6px;
      visibility: hidden;
      z-index: 3;
      display: none; /* éšè—æç¤ºæ¡† */
    }

    /* ç¤ºä¾‹å›¾ç‰‡å³ä¸Šè§’å€’è®¡æ—¶æ•°å­— */
    .panel-preview .countdown-number {
      position: absolute;
      top: 12px;
      right: 16px;
      background-color: rgba(0, 0, 0, 0.7);
      color: #FFF;
      font-size: 28px;
      padding: 4px 8px;
      border-radius: 4px;
      visibility: hidden;
      z-index: 4;
    }

    .panel-preview .progress-container {
      margin-bottom: 16px;
    }

    .panel-preview .progress-container .bar-bg {
      width: 100%;
      height: 8px;
      background-color: #E0E0E0;
      border-radius: 4px;
      overflow: hidden;
    }

    .panel-preview .progress-container .bar-fill {
      height: 100%;
      background-color: #007BFF;
      border-radius: 4px;
      width: 0%;
      transition: width 0.1s linear;
    }

    .panel-preview .progress-container .label {
      font-size: 14px;
      color: #FFF;
      margin-top: 8px;
      text-align: center;
    }

    .panel-preview .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }

    .panel-preview .btn {
      flex: 1;
      height: 36px;
      border-radius: 18px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }
    .panel-preview .btn.start-reset {
      background-color: #28A745;
      color: #FFFFFF;
    }
    .panel-preview .btn.start-reset:hover {
      background-color: #218838;
    }
    .panel-preview .btn.pause-continue {
      background-color: #007BFF;
      color: #FFFFFF;
    }
    .panel-preview .btn.pause-continue:hover {
      background-color: #0056b3;
    }

    /* å¿«é€Ÿé‡‡é›†æŒ‰é’®æ ·å¼ */
    .btn {
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }
    .btn:disabled {
      cursor: not-allowed;
      opacity: 0.65;
    }
    /* é€šç”¨å¿«é€Ÿé‡‡é›†æŒ‰é’®æ ·å¼ */
    .btn.quick-start,
    .btn.quick-pause,
    .btn.quick-stop {
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.2s ease;
      height: 40px;
      padding: 0 24px;
      min-width: 120px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
    }
    .btn.quick-start:focus {
      outline: 2px solid #007BFF;
      outline-offset: 2px;
    }
    .btn.quick-pause:focus {
      outline: 2px solid #6C757D;
      outline-offset: 2px;
    }
    .btn.quick-stop:focus {
      outline: 2px solid #D07B7B;
      outline-offset: 2px;
    }
    .btn.quick-start:disabled:focus,
    .btn.quick-pause:disabled:focus,
    .btn.quick-stop:disabled:focus {
      outline: 2px solid #6c757d;
      outline-offset: 2px;
    }
    .btn.quick-start:active {
      transform: translateY(1px);
    }
    .btn.quick-pause:active {
      transform: translateY(1px);
    }
    .btn.quick-stop:active {
      transform: translateY(1px);
    }
    .btn.quick-start:disabled:active,
    .btn.quick-pause:disabled:active,
    .btn.quick-stop:disabled:active {
      transform: none;
    }
    .btn.quick-start {
      background-color: #007BFF;
      color: #FFFFFF;
    }
    .btn.quick-start:hover {
      background-color: #0056b3;
    }
    .btn.quick-start:disabled {
      background-color: #e9ecef !important;
      color: #6c757d !important;
      cursor: not-allowed !important;
      opacity: 1 !important;
    }
    .btn.quick-start:disabled:hover {
      background-color: #e9ecef !important;
    }
    .btn.quick-pause {
      background-color: #6C757D;
      color: #FFFFFF;
    }
    .btn.quick-pause:hover {
      background-color: #5a6268;
    }
    .btn.quick-stop {
      background-color: #D07B7B;
      color: #FFFFFF;
    }
    .btn.quick-stop:hover {
      background-color: #c56464;
    }
    .btn.quick-pause:disabled {
      background-color: #e9ecef !important;
      color: #6c757d !important;
      cursor: not-allowed !important;
      opacity: 1 !important;
    }
    .btn.quick-pause:disabled:hover {
      background-color: #e9ecef !important;
    }
    .btn.quick-stop:disabled {
      background-color: #e9ecef !important;
      color: #6c757d !important;
      cursor: not-allowed !important;
      opacity: 1 !important;
    }
    .btn.quick-stop:disabled:hover {
      background-color: #e9ecef !important;
    }

    /* EMGæ•°æ®å¤„ç†å·²ç§»è‡³PythonæœåŠ¡å™¨ï¼Œå‰ç«¯ä¸å†éœ€è¦ç›¸å…³æ ·å¼ */

    /* ---- å³ä¾§ç”¨æˆ·ç®¡ç†é¢æ¿ ---- */
    .right-stack {
      position: fixed;
      right: 20px;
      top: 16px;
      width: 300px;
      height: calc(100vh - 32px);
      display: flex;
      flex-direction: column;
      gap: 16px;
      overflow-y: auto;
    }
    .user-management {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .user-management .buttons-container {
      display: flex;
      gap: 12px;
    }
    .user-management .action-btn {
      flex: 1;
      height: 32px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }
    .user-management .new-btn {
      background-color: #007BFF;
      color: #FFFFFF;
    }
    .user-management .new-btn:hover {
      background-color: #0056b3;
    }
    .user-management .export-btn {
      background-color: #28A745;
      color: #FFFFFF;
    }
    .user-management .export-btn:hover {
      background-color: #218838;
    }
    .user-management .btn-icon {
      width: 16px;
      height: 16px;
    }

    /* ç”¨æˆ·è¾“å…¥è¡¨å• */
    .user-input-form {
      background-color: #FFFFFF;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }
    .user-input-form label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .user-input-form label:last-child {
      margin-bottom: 0;
    }
    .user-input-form label span {
      flex: 0 0 60px;
      color: #555555;
    }
    .user-input-form label input {
      flex: 1;
      height: 32px;
      padding: 4px 12px;
      border: 1px solid #E0E0E0;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.2s;
    }
    .user-input-form label input:focus {
      outline: none;
      border-color: #007BFF;
    }

    /* ç”¨æˆ·åˆ—è¡¨æ˜¾ç¤ºåŒºåŸŸ */
    .users-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    /* å·²é‡‡é›†ç”¨æˆ·åˆ—è¡¨ */
    .collected-users-list {
      background-color: #FFFFFF;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
      margin-top: 16px;
    }
    
    .collected-users-list h3 {
      font-size: 16px;
      font-weight: 500;
      color: #333333;
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid #E0E0E0;
    }
    
    .user-item {
      background-color: #FFFFFF;
      border-radius: 12px;
      padding: 10px 12px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .user-item .user-info {
      flex: 1;
    }
    .user-item .user-info h3 {
      font-size: 14px;
      font-weight: 500;
      color: #333333;
      margin-bottom: 4px;
      border-bottom: none;
      padding-bottom: 0;
    }
    .user-item .user-info p {
      font-size: 12px;
      color: #666666;
    }
    .user-item .delete-btn {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: none;
      background-color: #FEE2E2;
      color: #DC2626;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .user-item .delete-btn:hover {
      background-color: #FCA5A5;
    }
    .user-item .delete-btn svg {
      width: 16px;
      height: 16px;
    }

    /* ========== å“åº”å¼è°ƒæ•´ ========== */
    @media (max-width: 1200px) {
      .main-panel {
        flex-direction: column;
        height: auto;
      }
      .panel-emg, .preview-container {
        width: 100%;
        height: 50vh;
        min-height: 300px;
      }
      .panel-emg {
        padding: 18px;
      }
      .face-capture-placeholder .icon {
        font-size: 42px;
      }
    }
    
    @media (max-width: 768px) {
      .btn.quick-start,
      .btn.quick-pause,
      .btn.quick-stop {
        min-width: 100px;
        padding: 0 16px;
        font-size: 13px;
        height: 36px;
      }
    }
    
    @media (max-width: 480px) {
      .btn.quick-start,
      .btn.quick-pause,
      .btn.quick-stop {
        min-width: 80px;
        padding: 0 12px;
        font-size: 12px;
        height: 34px;
        flex: 1;
      }
      .btn.quick-start {
        flex: 1.5;
      }
      .main-panel [style*="display: flex"] {
        gap: 12px !important;
      }
      .panel-emg, .preview-container {
        height: 40vh;
        min-height: 250px;
      }
      .panel-emg {
        padding: 16px;
      }
      .panel-emg .title {
        font-size: 14px;
        margin-bottom: 12px;
      }
      .face-capture-placeholder .icon {
        font-size: 36px;
      }
      .face-capture-placeholder {
        font-size: 12px;
        gap: 8px;
      }
    }
  </style>
  <script type="importmap">
    {
      "imports": {
        "three": "./libs/three.module.js",
        "three/addons/": "./libs/examples/"
      }
    }
  </script>
</head>
<body>
  <div class="container">
    <!-- ========== å·¦ä¾§å¯¼èˆªæ  ========== -->
    <aside class="sidebar">
      <div class="logo">
        é¢ç˜«åº·å¤ç³»ç»Ÿ
      </div>
      <nav>
        <ul>
          <li><a href="index.html">æ‚£è€…ç®¡ç†</a></li>
          <li><a href="data-collection.html" class="active">æ•°æ®é‡‡é›†</a></li>
          <li><a href="device.html">è®¾å¤‡ç®¡ç†</a></li>
        </ul>
        <div class="divider"></div>
        <ul>
          <li><a href="#" style="font-weight:600; font-size:16px;">åº·å¤è®­ç»ƒ</a></li>
          <ul class="submenu">
            <li><a href="active-rehab.html">ä¸»åŠ¨åº·å¤</a></li>
            <li><a href="passive-rehab.html">è¢«åŠ¨åº·å¤</a></li>
          </ul>
        </ul>
      </nav>
    </aside>

    <!-- ========== ä¸­é—´ä¸»å†…å®¹åŒº ========== -->
    <main class="main-content">
      <!-- ä¸­é—´å†…å®¹åŒºåŸŸ -->
      <div class="center-content">
        <!-- ä¸»é¢æ¿ï¼šè‚Œç”µé‡‡é›† + è§†é¢‘é¢„è§ˆ -->
        <div class="main-panel">
          <!-- è‚Œç”µé‡‡é›†åŒºåŸŸ - å·¦ä¾§ -->
          <div class="panel-emg">
            <div class="title">é¢éƒ¨è¡¨æƒ…é¢„è§ˆ</div>
            <div class="content">
              <div id="info" style="display: none;">
                <a href="https://threejs.org" target="_blank" rel="noopener">three.js</a> webgl - morph targets - webcam<br/>
                model by <a href="https://www.bannaflak.com/face-cap" target="_blank" rel="noopener">Face Cap</a>
              </div>
              <div id="face-capture-container">
                <div class="face-capture-placeholder">
                  <div class="icon">ğŸ“¹</div>
                  <div>é¢éƒ¨è¡¨æƒ…é¢„è§ˆåŒºåŸŸ</div>
                  <div style="font-size: 12px; color: #999;">ç­‰å¾…åˆå§‹åŒ–...</div>
                </div>
              </div>
            </div>
          </div>

          <!-- è§†é¢‘é¢„è§ˆåŒºåŸŸ - å³ä¾§ -->
          <div class="preview-container">
            <div class="panel-preview">
              <div class="task-title" id="taskTitle">ä»»åŠ¡ï¼šå¾…å¼€å§‹</div>
              <div class="video-box">
                <!-- ç¤ºä¾‹å›¾ç‰‡ & è§†é¢‘ å…ƒç´  -->
                <img id="actionImage" src="" alt="ç¤ºä¾‹å›¾" style="display: none;" />
                <video id="previewVideo" width="100%" height="100%" style="display: none;"></video>

                <!-- å±…ä¸­ç°è‰²æç¤ºæ¡† -->
                <div class="center-overlay" id="centerOverlay">
                  <div id="overlayText"></div>
                </div>
                <!-- åº•éƒ¨ç°è‰²æç¤ºæ¡† -->
                <div class="bottom-overlay" id="bottomOverlay">
                  <div id="bottomText"></div>
                </div>

                <!-- ç¤ºä¾‹å›¾ç‰‡å³ä¸Šè§’å€’è®¡æ—¶æ•°å­— -->
                <div class="countdown-number" id="countdownNumber"></div>
              </div>
              <div class="progress-container">
                <div class="bar-bg">
                  <div class="bar-fill" id="barFill"></div>
                </div>
                <div class="label" id="progressLabel">1/9</div>
              </div>
              <div class="btn-group">
                <button class="btn start-reset" id="startResetBtn">å¼€å§‹</button>
                <button class="btn pause-continue" id="pauseContinueBtn" disabled>æš‚åœ</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ç§»é™¤EMGæ•°æ®æ˜¾ç¤ºåŒºåŸŸï¼Œç°åœ¨ç”±Pythonå¤„ç†æ‰€æœ‰æ•°æ® -->
        
        <!-- æ–°å¢å¿«é€Ÿé‡‡é›†åŠŸèƒ½é¢æ¿ -->
        <div class="main-panel" style="height: auto; margin-bottom: 16px;">
          <div style="width: 100%; background-color: #FFFFFF; border-radius: 12px; padding: 16px; box-shadow: 0 1px 4px rgba(0,0,0,0.05);">
            <h3 style="font-size: 16px; font-weight: 500; color: #333333; margin-bottom: 12px;">å¿«é€Ÿé‡‡é›†æ¨¡å¼</h3>
            <p style="font-size: 14px; color: #666666; margin-bottom: 16px;">ä»…æŒ‰é¡ºåºå±•ç¤ºæ¯ä¸ªåŠ¨ä½œå›¾ç‰‡2ç§’ï¼Œæ— è§†é¢‘æ¼”ç¤ºï¼Œç›´æ¥è¿›è¡Œè‚Œç”µæ•°æ®é‡‡é›†ã€‚</p>
            <div style="display: flex; gap: 16px; flex-wrap: wrap; align-items: center; justify-content: flex-start;">
              <button class="btn quick-start" id="quickStartBtn">å¼€å§‹å¿«é€Ÿé‡‡é›†</button>
              <button class="btn quick-pause" id="quickPauseBtn" disabled>æš‚åœ</button>
              <button class="btn quick-stop" id="quickStopBtn" disabled>ç»“æŸ</button>
            </div>
          </div>
        </div>
      </div>

      <!-- å³ä¾§ç”¨æˆ·ç®¡ç†é¢æ¿ -->
      <div class="right-stack">
        <div class="user-management">
          <!-- é¡¶éƒ¨æŒ‰é’® -->
          <div class="buttons-container">
            <button class="action-btn new-btn" id="addUserBtn">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
              </svg>
              æ·»åŠ ç”¨æˆ·
            </button>
            <button class="action-btn export-btn" id="exportBtn">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
              </svg>
              æ•°æ®è¯´æ˜
            </button>
          </div>

          <!-- ç”¨æˆ·è¾“å…¥è¡¨å• -->
          <div class="user-input-form">
            <label>
              <span>å§“åï¼š</span>
              <input type="text" name="name" id="userName" placeholder="è¯·è¾“å…¥å§“å" />
            </label>
            <label>
              <span>å¹´é¾„ï¼š</span>
              <input type="number" name="age" id="userAge" placeholder="è¯·è¾“å…¥å¹´é¾„" />
            </label>
            <label>
              <span>åŒºåŸŸï¼š</span>
              <select name="region" id="userRegion" style="flex: 1; height: 32px; padding: 4px 12px; border: 1px solid #E0E0E0; border-radius: 6px; font-size: 14px;">
                <option value="">è¯·é€‰æ‹©åŒºåŸŸ</option>
                <option value="left">left</option>
                <option value="right">right</option>
              </select>
            </label>
            <label>
              <span>çŠ¶æ€ï¼š</span>
              <select name="status" id="userStatus" style="flex: 1; height: 32px; padding: 4px 12px; border: 1px solid #E0E0E0; border-radius: 6px; font-size: 14px;">
                <option value="">è¯·é€‰æ‹©çŠ¶æ€</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
                <option value="24">24</option>
                <option value="25">25</option>
                <option value="26">26</option>
                <option value="27">27</option>
                <option value="28">28</option>
                <option value="29">29</option>
                <option value="30">30</option>
                <option value="31">31</option>
                <option value="32">32</option>
                <option value="33">33</option>
                <option value="34">34</option>
                <option value="35">35</option>
                <option value="36">36</option>
                <option value="37">37</option>
                <option value="38">38</option>
                <option value="39">39</option>
                <option value="40">40</option>
                <option value="41">41</option>
                <option value="42">42</option>
                <option value="43">43</option>
                <option value="44">44</option>
                <option value="45">45</option>
                <option value="46">46</option>
                <option value="47">47</option>
                <option value="48">48</option>
                <option value="49">49</option>
                <option value="50">50</option>
              </select>
            </label>
            <label>
              <span>æ—¥æœŸï¼š</span>
              <input type="date" name="date" id="userDate" style="flex: 1; height: 32px; padding: 4px 12px; border: 1px solid #E0E0E0; border-radius: 6px; font-size: 14px;" />
            </label>
          </div>

          <!-- å·²é‡‡é›†ç”¨æˆ·åˆ—è¡¨ -->
          <div class="collected-users-list">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #E0E0E0;">
              <h3 style="margin: 0; border: none; padding: 0;">å·²é‡‡é›†ç”¨æˆ·</h3>
              <span id="userCount" style="background-color: #007BFF; color: white; font-size: 11px; padding: 2px 6px; border-radius: 10px; font-weight: 500;">0</span>
            </div>
            <div class="users-list" id="collectedUsersList">
              <!-- ç”¨æˆ·åˆ—è¡¨é¡¹ä¼šé€šè¿‡ JavaScript åŠ¨æ€æ·»åŠ  -->
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- å¼•ç”¨å¤–éƒ¨JavaScriptæ–‡ä»¶ -->
  <script src="js/main.js"></script>
  <script type="module" src="js/face-init.js"></script>
  <script>
    // æ•°æ®é‡‡é›†é¡µé¢ç‰¹å®šçš„JavaScript
    document.addEventListener('DOMContentLoaded', () => {
      // æ£€æŸ¥å¹¶ä¿å­˜å¯¹main.jsä¸­speakå‡½æ•°çš„å¼•ç”¨
      if (typeof window.speak === 'function' && window.speak !== speak) {
        // å…¨å±€speakå‡½æ•°å­˜åœ¨ï¼Œå¹¶ä¸”ä¸å½“å‰é¡µé¢çš„speakå‡½æ•°ä¸åŒ
        console.log('æ£€æµ‹åˆ°å…¨å±€speakå‡½æ•°ï¼Œå°†ä½¿ç”¨å…¨å±€å‡½æ•°é¿å…é‡å¤æ’­æŠ¥');
        window.mainSpeak = window.speak;
      }
      
      // è·å–ç”¨æˆ·ä¿¡æ¯è¡¨å•å…ƒç´ 
      const userNameInput = document.getElementById('userName');
      const userAgeInput = document.getElementById('userAge');
      const userRegionSelect = document.getElementById('userRegion');
      const userStatusSelect = document.getElementById('userStatus');
      const userDateInput = document.getElementById('userDate');
      
      // å°è¯•ä»localStorageåŠ è½½ä¹‹å‰ä¿å­˜çš„ç”¨æˆ·ä¿¡æ¯
      const loadUserInfo = () => {
        const savedUserName = localStorage.getItem('datacollect_userName');
        const savedUserAge = localStorage.getItem('datacollect_userAge');
        const savedUserRegion = localStorage.getItem('datacollect_userRegion');
        const savedUserStatus = localStorage.getItem('datacollect_userStatus');
        const savedUserDate = localStorage.getItem('datacollect_userDate');
        
        if (savedUserName) userNameInput.value = savedUserName;
        if (savedUserAge) userAgeInput.value = savedUserAge;
        if (savedUserRegion) userRegionSelect.value = savedUserRegion;
        if (savedUserStatus) userStatusSelect.value = savedUserStatus;
        if (savedUserDate) userDateInput.value = savedUserDate;
        
        return (savedUserName && savedUserAge && savedUserRegion && savedUserStatus && savedUserDate);
      };
      
      // ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°localStorage
      const saveUserInfo = () => {
        const userName = userNameInput.value.trim();
        const userAge = userAgeInput.value.trim();
        const userRegion = userRegionSelect.value;
        const userStatus = userStatusSelect.value;
        const userDate = userDateInput.value;
        
        if (userName) localStorage.setItem('datacollect_userName', userName);
        if (userAge) localStorage.setItem('datacollect_userAge', userAge);
        if (userRegion) localStorage.setItem('datacollect_userRegion', userRegion);
        if (userStatus) localStorage.setItem('datacollect_userStatus', userStatus);
        if (userDate) localStorage.setItem('datacollect_userDate', userDate);
      };
      
      // ä¿å­˜å·²é‡‡é›†ç”¨æˆ·åˆ—è¡¨åˆ°localStorage
      const saveCollectedUsers = () => {
        const usersList = [];
        const userItems = document.querySelectorAll('#collectedUsersList .user-item');
        
        userItems.forEach(item => {
          const userInfo = item.querySelector('.user-info');
          const userName = userInfo.querySelector('h3').textContent;
          const userDetails = userInfo.querySelector('p').textContent;
          
          usersList.push({
            name: userName,
            details: userDetails,
            timestamp: Date.now()
          });
        });
        
        localStorage.setItem('datacollect_collectedUsers', JSON.stringify(usersList));
      };
      
      // ä»localStorageåŠ è½½å·²é‡‡é›†ç”¨æˆ·åˆ—è¡¨
      const loadCollectedUsers = () => {
        try {
          const savedUsers = localStorage.getItem('datacollect_collectedUsers');
          if (!savedUsers) return;
          
          const usersList = JSON.parse(savedUsers);
          const collectedUsersList = document.getElementById('collectedUsersList');
          
          // æ¸…ç©ºç°æœ‰åˆ—è¡¨
          collectedUsersList.innerHTML = '';
          
          usersList.forEach(userData => {
            const userItem = createUserItem(userData.name, userData.details);
            collectedUsersList.appendChild(userItem);
          });
          
          // æ›´æ–°ç”¨æˆ·è®¡æ•°
          updateUserCount();
          
        } catch (error) {
          console.error('åŠ è½½å·²é‡‡é›†ç”¨æˆ·åˆ—è¡¨å¤±è´¥:', error);
        }
      };
      
      // åˆ›å»ºç”¨æˆ·é¡¹å…ƒç´ çš„å‡½æ•°
      const createUserItem = (userName, userDetails) => {
        const userItem = document.createElement('div');
        userItem.className = 'user-item';
        
        userItem.innerHTML = `
          <div class="user-info">
            <h3>${userName}</h3>
            <p>${userDetails}</p>
          </div>
          <button class="delete-btn">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
            </svg>
          </button>
        `;
        
        // æ·»åŠ åˆ é™¤æŒ‰é’®åŠŸèƒ½
        userItem.querySelector('.delete-btn').addEventListener('click', () => {
          if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç”¨æˆ·è®°å½•å—ï¼Ÿ')) {
            userItem.remove();
            saveCollectedUsers(); // åˆ é™¤åä¿å­˜åˆ—è¡¨
            updateUserCount(); // æ›´æ–°ç”¨æˆ·è®¡æ•°
          }
        });
        
        return userItem;
      };
      
      // æ›´æ–°ç”¨æˆ·è®¡æ•°æ˜¾ç¤º
      const updateUserCount = () => {
        const userCount = document.querySelectorAll('#collectedUsersList .user-item').length;
        document.getElementById('userCount').textContent = userCount;
      };
      
      // åŠ è½½ä¹‹å‰ä¿å­˜çš„ç”¨æˆ·ä¿¡æ¯
      const hasExistingInfo = loadUserInfo();
      
      // å¦‚æœæ²¡æœ‰ä¿å­˜çš„æ—¥æœŸï¼Œè®¾ç½®é»˜è®¤ä¸ºä»Šå¤©
      if (!userDateInput.value) {
        const today = new Date();
        const dateString = today.toISOString().split('T')[0];
        userDateInput.value = dateString;
      }
      
      // åŠ è½½å·²é‡‡é›†ç”¨æˆ·åˆ—è¡¨
      loadCollectedUsers();
      
      // åˆå§‹åŒ–æ—¶æ›´æ–°ç”¨æˆ·è®¡æ•°ï¼ˆé˜²æ­¢loadCollectedUserså¤±è´¥æ—¶è®¡æ•°ä¸æ­£ç¡®ï¼‰
      setTimeout(updateUserCount, 100);
      
      // æ·»åŠ ç”¨æˆ·è¾“å…¥å˜åŒ–ç›‘å¬å™¨ï¼Œè‡ªåŠ¨ä¿å­˜åˆ°localStorage
      userNameInput.addEventListener('input', () => {
        if (userNameInput.value.trim()) {
          localStorage.setItem('datacollect_userName', userNameInput.value.trim());
        }
      });
      
      userAgeInput.addEventListener('input', () => {
        if (userAgeInput.value.trim()) {
          localStorage.setItem('datacollect_userAge', userAgeInput.value.trim());
        }
      });
      
      userRegionSelect.addEventListener('change', () => {
        if (userRegionSelect.value) {
          localStorage.setItem('datacollect_userRegion', userRegionSelect.value);
        }
      });
      
      userStatusSelect.addEventListener('change', () => {
        if (userStatusSelect.value) {
          localStorage.setItem('datacollect_userStatus', userStatusSelect.value);
        }
      });
      
      userDateInput.addEventListener('change', () => {
        if (userDateInput.value) {
          localStorage.setItem('datacollect_userDate', userDateInput.value);
        }
      });
      
      // æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯å¹¶è¯¢é—®æ˜¯å¦éœ€è¦æ›´æ–°çŠ¶æ€
      const checkUserInfoBeforeStart = () => {
        const userName = userNameInput.value.trim();
        const userAge = userAgeInput.value.trim();
        const userRegion = userRegionSelect.value;
        const userStatus = userStatusSelect.value;
        const userDate = userDateInput.value;
        
        if (!userName) {
          alert('è¯·è¾“å…¥ç”¨æˆ·å§“å');
          userNameInput.focus();
          return false;
        }
        
        if (!userAge) {
          alert('è¯·è¾“å…¥ç”¨æˆ·å¹´é¾„');
          userAgeInput.focus();
          return false;
        }
        
        if (!userRegion) {
          alert('è¯·é€‰æ‹©åŒºåŸŸ');
          userRegionSelect.focus();
          return false;
        }
        
        if (!userStatus) {
          alert('è¯·é€‰æ‹©ç”¨æˆ·çŠ¶æ€');
          userStatusSelect.focus();
          return false;
        }
        
        if (!userDate) {
          alert('è¯·é€‰æ‹©æ—¥æœŸ');
          userDateInput.focus();
          return false;
        }
        
        // å¦‚æœå‘ç°æœ‰ä¿å­˜çš„ä¿¡æ¯ï¼Œè¯¢é—®æ˜¯å¦éœ€è¦æ›´æ–°çŠ¶æ€
        if (hasExistingInfo) {
          const updateStatus = confirm(`å‘ç°å½“å‰ç”¨æˆ·(${userName})å·²æœ‰ä¿¡æ¯è®°å½•ï¼Œæ˜¯å¦éœ€è¦é‡æ–°é€‰æ‹©çŠ¶æ€ï¼Ÿ\nç‚¹å‡»"ç¡®è®¤"ä¿®æ”¹çŠ¶æ€ï¼Œç‚¹å‡»"å–æ¶ˆ"ä¿æŒå½“å‰çŠ¶æ€ç»§ç»­ã€‚`);
          if (updateStatus) {
            userStatusSelect.focus();
            return false;
          }
        }
        
        // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
        saveUserInfo();
        return true;
      };
      
      // æ·»åŠ ç”¨æˆ·æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      document.getElementById('addUserBtn').addEventListener('click', () => {
        // è·å–ç”¨æˆ·è¾“å…¥
        const userName = userNameInput.value.trim();
        const userAge = userAgeInput.value.trim();
        const userRegion = userRegionSelect.value;
        const userStatus = userStatusSelect.value;
        const userDate = userDateInput.value;
        
        // éªŒè¯è¾“å…¥
        if (!userName) {
          alert('è¯·è¾“å…¥å§“å');
          return;
        }
        
        // ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°localStorage
        saveUserInfo();
        
        // åˆ›å»ºç”¨æˆ·è¯¦æƒ…å­—ç¬¦ä¸²
        const userDetails = `å¹´é¾„: ${userAge || 'æœªå¡«å†™'}, åŒºåŸŸ: ${userRegion || 'æœªå¡«å†™'}, çŠ¶æ€: ${userStatus || 'æœªå¡«å†™'}, æ—¥æœŸ: ${userDate || 'æœªå¡«å†™'}`;
        
        // ä½¿ç”¨createUserItemå‡½æ•°åˆ›å»ºæ–°çš„ç”¨æˆ·é¡¹
        const userItem = createUserItem(userName, userDetails);
        
        // æ·»åŠ åˆ°å·²é‡‡é›†ç”¨æˆ·åˆ—è¡¨
        document.getElementById('collectedUsersList').appendChild(userItem);
        
        // ä¿å­˜å·²é‡‡é›†ç”¨æˆ·åˆ—è¡¨
        saveCollectedUsers();
        
        // æ›´æ–°ç”¨æˆ·è®¡æ•°
        updateUserCount();
        
        // æ¸…ç©ºè¾“å…¥æ¡†
        // ä¸å†æ¸…ç©ºè¾“å…¥æ¡†ï¼Œä¿ç•™ç”¨æˆ·ä¿¡æ¯
        // userNameInput.value = '';
        // userAgeInput.value = '';
        // userRegionSelect.value = '';
        // userStatusSelect.value = '';
        // userDateInput.value = '';
      });
      

      
      // å¿«é€Ÿé‡‡é›†åŠŸèƒ½
      const quickStartBtn = document.getElementById('quickStartBtn');
      const quickPauseBtn = document.getElementById('quickPauseBtn');
      const quickStopBtn = document.getElementById('quickStopBtn');
      
      // å¿«é€Ÿé‡‡é›†æ§åˆ¶å˜é‡
      let isQuickCollectionRunning = false;
      let isQuickCollectionPaused = false;
      let shouldStopCollection = false;
      
      if (quickStartBtn) {
        quickStartBtn.addEventListener('click', () => {
          // æ£€æŸ¥å’ŒéªŒè¯ç”¨æˆ·ä¿¡æ¯
          if (checkUserInfoBeforeStart()) {
            startQuickCollection();
          }
        });
      }
      
      if (quickPauseBtn) {
        quickPauseBtn.addEventListener('click', () => {
          if (isQuickCollectionPaused) {
            // ç»§ç»­é‡‡é›†
            isQuickCollectionPaused = false;
            quickPauseBtn.innerText = 'æš‚åœ';
            document.getElementById('taskTitle').innerText += ' (ç»§ç»­ä¸­)';
          } else {
            // æš‚åœé‡‡é›†
            isQuickCollectionPaused = true;
            quickPauseBtn.innerText = 'ç»§ç»­';
            document.getElementById('taskTitle').innerText += ' (å·²æš‚åœ)';
          }
        });
      }
      
      if (quickStopBtn) {
        quickStopBtn.addEventListener('click', () => {
          if (confirm('ç¡®å®šè¦ç»“æŸå½“å‰é‡‡é›†è¿‡ç¨‹å—ï¼Ÿ')) {
            shouldStopCollection = true;
            document.getElementById('taskTitle').innerText = 'æ­£åœ¨ç»“æŸé‡‡é›†...';
          }
        });
      }
      
      // è¯­éŸ³æ’­æŠ¥å‡½æ•° (é¡µé¢ä¸“ç”¨ï¼Œé¿å…ä¸main.jsä¸­çš„å…¨å±€speakå‡½æ•°é‡å)
      function speakInDataCollection(text) {
        return new Promise((resolve) => {
          try {
            console.log(`ğŸ¤ å¼€å§‹è¯­éŸ³æ’­æŠ¥: "${text}"`);
            
            // æ£€æŸ¥è¯­éŸ³åˆæˆæ˜¯å¦å¯ç”¨
            if (!('speechSynthesis' in window)) {
              console.warn('æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆï¼Œè·³è¿‡è¯­éŸ³æ’­æŠ¥');
              resolve();
              return;
            }

            const utterance = new SpeechSynthesisUtterance(text);
            
            // è®¾ç½®è¾ƒçŸ­çš„è¶…æ—¶æœºåˆ¶ï¼ˆ5ç§’è¶…æ—¶ï¼‰
            const timeout = setTimeout(() => {
              console.warn(`è¯­éŸ³æ’­æŠ¥è¶…æ—¶: "${text}"`);
              try {
                speechSynthesis.cancel();
              } catch (e) {
                console.warn('å–æ¶ˆè¯­éŸ³æ’­æŠ¥æ—¶å‡ºé”™:', e);
              }
              resolve(); // è¶…æ—¶ä¹Ÿå½“ä½œå®Œæˆå¤„ç†
            }, 5000);
            
            let hasResolved = false;
            
            const resolveOnce = () => {
              if (hasResolved) return;
              hasResolved = true;
              clearTimeout(timeout);
              console.log(`âœ… è¯­éŸ³æ’­æŠ¥å®Œæˆ: "${text}"`);
              resolve();
            };
            
            utterance.onend = resolveOnce;
            utterance.onerror = (error) => {
              console.warn(`è¯­éŸ³æ’­æŠ¥é”™è¯¯: "${text}"`, error);
              resolveOnce(); // é”™è¯¯ä¹Ÿå½“ä½œå®Œæˆå¤„ç†ï¼Œä¸é˜»å¡æµç¨‹
            };
            
            // ç«‹å³å¼€å§‹æ’­æ”¾
            try {
              speechSynthesis.speak(utterance);
              console.log(`ğŸµ è¯­éŸ³å¼€å§‹æ’­æ”¾: "${text}"`);
            } catch (speakError) {
              console.warn(`è¯­éŸ³æ’­æ”¾å¯åŠ¨å¤±è´¥: "${text}"`, speakError);
              resolveOnce();
            }
            
          } catch (error) {
            console.error('è¯­éŸ³åˆæˆåˆå§‹åŒ–é”™è¯¯:', error);
            resolve(); // é”™è¯¯ä¹Ÿå½“ä½œå®Œæˆå¤„ç†
          }
        });
      }
      
      // ç­‰å¾…éæš‚åœçŠ¶æ€çš„å‡½æ•°
      async function waitIfPaused() {
        while (isQuickCollectionPaused && !shouldStopCollection) {
          await new Promise(resolve => setTimeout(resolve, 100));
        }
        return shouldStopCollection; // è¿”å›æ˜¯å¦åº”è¯¥åœæ­¢æ•´ä¸ªé‡‡é›†è¿‡ç¨‹
      }
      
      // æ›´æ–°åçš„å¿«é€Ÿé‡‡é›†å‡½æ•°
      async function startQuickCollection() {
        // è·å–ç”¨æˆ·ä¿¡æ¯ - æ— éœ€å†éªŒè¯ï¼Œå› ä¸ºåœ¨ç‚¹å‡»æŒ‰é’®æ—¶å·²ç»éªŒè¯è¿‡äº†
        const userName = userNameInput.value.trim();
        const userAge = userAgeInput.value.trim();
        const userRegion = userRegionSelect.value;
        const userStatus = userStatusSelect.value;
        
        // é‡ç½®æ§åˆ¶å˜é‡
        isQuickCollectionRunning = true;
        isQuickCollectionPaused = false;
        shouldStopCollection = false;
        
        // ä¿®æ”¹æŒ‰é’®çŠ¶æ€
        quickStartBtn.disabled = true;
        quickPauseBtn.disabled = false;
        quickStopBtn.disabled = false;
        quickStartBtn.innerText = 'é‡‡é›†ä¸­...';
        document.getElementById('startResetBtn').disabled = true; // ç¦ç”¨æ™®é€šé‡‡é›†æŒ‰é’®
        
        const taskTitleElem = document.getElementById('taskTitle');
        const actionImage = document.getElementById('actionImage');
        const previewVideo = document.getElementById('previewVideo');
        const barFill = document.getElementById('barFill');
        const progressLabel = document.getElementById('progressLabel');
        
        try {
          // ä½¿ç”¨å¤–éƒ¨å®šä¹‰çš„actionsæ•°ç»„
          // å‡è®¾actionsæ•°ç»„æ˜¯ä»main.jsä¸­å®šä¹‰çš„å…¨å±€å˜é‡
          if (typeof actions === 'undefined') {
            throw new Error('æ— æ³•è®¿é—®åŠ¨ä½œæ•°æ®ï¼Œè¯·ç¡®è®¤main.jså·²æ­£ç¡®åŠ è½½');
          }
          
          for (let i = 0; i < actions.length; i++) {
            // æ£€æŸ¥æ˜¯å¦åº”è¯¥åœæ­¢æ•´ä¸ªæµç¨‹
            if (shouldStopCollection) {
              console.log('ç”¨æˆ·è¯·æ±‚åœæ­¢é‡‡é›†');
              break;
            }
            
            const action = actions[i];
            
            // æ›´æ–°è¿›åº¦æ˜¾ç¤º
            updateProgressBar((i) / actions.length);
            progressLabel.innerText = `${i + 1}/${actions.length}`;
            taskTitleElem.innerText = action.name;
            
            // 1. æ˜¾ç¤ºåŠ¨ä½œå›¾ç‰‡å’Œè¯­éŸ³æ’­æŠ¥åŠ¨ä½œåºå·å’Œåç§°
            previewVideo.style.display = 'none';
            actionImage.src = action.img;
            actionImage.style.display = 'block';
            await speak(`${action.name}`);
            
            if (await waitIfPaused()) break; // æ£€æŸ¥æš‚åœçŠ¶æ€
            
            // ç­‰å¾…3ç§’å±•ç¤ºå›¾ç‰‡ï¼ŒåŒæ—¶æ£€æŸ¥æš‚åœçŠ¶æ€
            for (let wait = 0; wait < 1; wait++) {
              await new Promise(resolve => setTimeout(resolve, 500));
              if (await waitIfPaused()) break; // å¦‚æœåº”è¯¥åœæ­¢ï¼Œåˆ™ä¸­æ–­ç­‰å¾…
            }
            
            // å†æ¬¡æ£€æŸ¥æ˜¯å¦åº”è¯¥åœæ­¢
            if (shouldStopCollection) break;
            
            // 2. è¯­éŸ³æ’­æŠ¥"å³å°†é‡‡é›†ï¼Œè¯·å‡†å¤‡"
            taskTitleElem.innerText = `${action.name} - å‡†å¤‡é‡‡é›†`;
            await speakInDataCollection('å³å°†é‡‡é›†ï¼Œè¯·å‡†å¤‡');
            
            // ç­‰å¾…2ç§’
            await new Promise(resolve => setTimeout(resolve, 500));
            
        
            // 3. å¼€å§‹é‡‡é›†æ•°æ®
            try {
              await sendCommandToPython('start_recording', {
                action_label: i,
                user_name: userName,
                user_age: userAge,
                region: userRegion,
                status: userStatus,
                date: userDateInput.value
              });
              console.log(`ğŸ”´ å¼€å§‹å¿«é€Ÿè®°å½• - åŠ¨ä½œ${i}: ${action.name}`);
            } catch (error) {
              console.error('å‘é€å¼€å§‹è®°å½•æŒ‡ä»¤å¤±è´¥:', error);
              if (shouldStopCollection) break;
            }
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // 4. è¯­éŸ³"å‘åŠ›"
            taskTitleElem.innerText = `${action.name} - å‘åŠ›`;
            await speakInDataCollection('å‘åŠ›');
            
            await new Promise(resolve => setTimeout(resolve, 500));

            // 5. è¯­éŸ³"æ”¾æ¾"
            taskTitleElem.innerText = `${action.name} - æ”¾æ¾`;
            await speakInDataCollection('æ”¾æ¾');
            
            if (await waitIfPaused()) break;

            // 5. è¯­éŸ³"å·²å®Œæˆï¼Œå³å°†è¿›è¡Œä¸‹ä¸€åŠ¨ä½œ"
            if (i < actions.length - 1) {
              taskTitleElem.innerText = `å‡†å¤‡ä¸‹ä¸€ä¸ªåŠ¨ä½œ: ${actions[i+1].name}`;
              await speakInDataCollection('å·²å®Œæˆï¼Œå³å°†è¿›è¡Œä¸‹ä¸€åŠ¨ä½œ');
              
              if (await waitIfPaused()) break;
              
              // çŸ­æš‚ç­‰å¾…
              for (let wait = 0; wait < 1; wait++) {
                await new Promise(resolve => setTimeout(resolve, 500));
                if (await waitIfPaused()) break;
              }
            }
            
            // å†æ¬¡æ£€æŸ¥æ˜¯å¦åº”è¯¥åœæ­¢
            if (shouldStopCollection) break;
          }
          
          // æ‰€æœ‰åŠ¨ä½œå®Œæˆæˆ–ç”¨æˆ·ä¸­æ­¢
          const completionStatus = shouldStopCollection ? 'å·²ä¸­æ­¢' : 'å®Œæˆ';
          taskTitleElem.innerText = `å¿«é€Ÿé‡‡é›†${completionStatus}`;
          updateProgressBar(shouldStopCollection ? 0 : 1);
          
          // å…¨éƒ¨å®Œæˆåçš„è¯­éŸ³æç¤º
          if (!shouldStopCollection) {
            await speakInDataCollection('æ‰€æœ‰åŠ¨ä½œé‡‡é›†å®Œæˆï¼Œæ„Ÿè°¢æ‚¨çš„é…åˆ');
          }
          
          // æ·»åŠ ç”¨æˆ·åˆ°å·²é‡‡é›†åˆ—è¡¨
          const quickCollectionName = `${userName} (å¿«é€Ÿé‡‡é›†${shouldStopCollection ? '-éƒ¨åˆ†' : ''})`;
          const quickCollectionDetails = `å¹´é¾„: ${userAge || 'æœªå¡«å†™'}, åŒºåŸŸ: ${userRegion || 'æœªå¡«å†™'}, çŠ¶æ€: ${userStatus || 'æœªå¡«å†™'}, æ—¥æœŸ: ${userDateInput.value || 'æœªå¡«å†™'}`;
          
          // ä½¿ç”¨createUserItemå‡½æ•°åˆ›å»ºç”¨æˆ·é¡¹
          const userItem = createUserItem(quickCollectionName, quickCollectionDetails);
          
          // æ·»åŠ åˆ°å·²é‡‡é›†ç”¨æˆ·åˆ—è¡¨
          document.getElementById('collectedUsersList').appendChild(userItem);
          
          // ä¿å­˜å·²é‡‡é›†ç”¨æˆ·åˆ—è¡¨
          saveCollectedUsers();
          
          // æ›´æ–°ç”¨æˆ·è®¡æ•°
          updateUserCount();
          
          // å¦‚æœå®Œæˆäº†æ‰€æœ‰æ•°æ®é‡‡é›†ï¼Œåˆ™å¯¼å‡ºæ•°æ®
          if (!shouldStopCollection) {
            try {
              await sendCommandToPython('export_data', {
                user_name: userName,
                timestamp: new Date().toISOString()
              });
              console.log('ğŸ‰ å·²å‘é€å¯¼å‡ºæ•°æ®çš„æŒ‡ä»¤');
            } catch (error) {
              console.error('å‘é€å¯¼å‡ºæ•°æ®æŒ‡ä»¤å¤±è´¥:', error);
            }
          }
          
        } catch (error) {
          console.error('å¿«é€Ÿé‡‡é›†è¿‡ç¨‹ä¸­å‡ºé”™:', error);
          taskTitleElem.innerText = `é”™è¯¯: ${error.message}`;
        } finally {
          // å–æ¶ˆä»»ä½•æ­£åœ¨è¿›è¡Œçš„è¯­éŸ³æ’­æŠ¥
          if ('speechSynthesis' in window) {
            speechSynthesis.cancel();
          }
          
          // é‡ç½®æ§åˆ¶å˜é‡
          isQuickCollectionRunning = false;
          isQuickCollectionPaused = false;
          shouldStopCollection = false;
          
          // æ¢å¤æŒ‰é’®çŠ¶æ€
          quickStartBtn.disabled = false;
          quickStartBtn.innerText = 'å¼€å§‹å¿«é€Ÿé‡‡é›†';
          quickPauseBtn.disabled = true;
          quickPauseBtn.innerText = 'æš‚åœ';
          quickStopBtn.disabled = true;
          document.getElementById('startResetBtn').disabled = false;
        }
      }
      
      // è¿›åº¦æ¡æ›´æ–°å‡½æ•°
      function updateProgressBar(fraction) {
        const barFill = document.getElementById('barFill');
        if (barFill) {
          barFill.style.width = `${fraction * 100}%`;
        }
      }
      
      // é‡ç”¨main.jsä¸­çš„sendCommandToPythonå‡½æ•°
      // å¦‚æœåœ¨å…¨å±€èŒƒå›´å†…ä¸å¯ç”¨ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªç®€å•å®ç°
      if (typeof sendCommandToPython === 'undefined') {
        window.sendCommandToPython = function(command, data = {}) {
          return new Promise((resolve, reject) => {
            try {
              console.log(`ğŸ”„ åˆ›å»ºä¸´æ—¶è¿æ¥å‘é€æŒ‡ä»¤: ${command}`, data);
              
              const tempWs = new WebSocket('ws://localhost:8765');
              
              const connectionTimeout = setTimeout(() => {
                console.error('WebSocketè¿æ¥è¶…æ—¶');
                reject(new Error('è¿æ¥è¶…æ—¶'));
              }, 3000);
              
              tempWs.onopen = () => {
                clearTimeout(connectionTimeout);
                const message = {
                  command: command,
                  ...data
                };
                tempWs.send(JSON.stringify(message));
                console.log('âœ… æŒ‡ä»¤å‘é€æˆåŠŸ:', command, data);
                
                setTimeout(() => {
                  tempWs.close();
                  resolve();
                }, 50);
              };
              
              tempWs.onerror = (error) => {
                clearTimeout(connectionTimeout);
                console.warn('ä¸´æ—¶è¿æ¥å¤±è´¥:', error);
                reject(error);
              };
              
            } catch (error) {
              console.error('åˆ›å»ºä¸´æ—¶è¿æ¥æ—¶å‡ºé”™:', error);
              reject(error);
            }
          });
        };
      }
    });
  </script>
</body>
</html> 